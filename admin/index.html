<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Orders</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/chat.css">
<script>
(function () {
  try {
    var path = window.location.pathname || "";
    if (path.toLowerCase().endsWith(".html")) {
      var noExt = path.replace(/index\.html$/i, "").replace(/\.html$/i, "");
      try { localStorage.setItem("triedHtmlUrl", path); } catch (e) {}
      window.location.replace(noExt + window.location.search + window.location.hash);
      return;
    }
  } catch (e) {}

  function shouldSkip(href) {
    if (!href) return true;
    var l = href.toLowerCase().trim();
    return (
      l.startsWith("#") ||
      l.startsWith("mailto:") ||
      l.startsWith("tel:") ||
      l.startsWith("javascript:") ||
      l.startsWith("data:") ||
      l.startsWith("http://") ||
      l.startsWith("https://") ||
      l.startsWith("//") ||
      // If a colon appears before a slash it's likely a scheme (e.g., app:)
      (l.indexOf(":") > -1 && l.indexOf(":") < l.indexOf("/"))
    );
  }

  function stripHtmlExt(u) {
    // Drop index.html then .html when at end or before ?/#
    u = u.replace(/index\.html(?=[?#]|$)/i, "");
    u = u.replace(/\.html(?=[?#]|$)/i, "");
    if (u === "") u = "./";
    return u;
  }

  document.addEventListener("DOMContentLoaded", function () {
    // Rewrite in-document links
    document.querySelectorAll('a[href]').forEach(function (a) {
      var href = a.getAttribute('href');
      if (shouldSkip(href)) return;
      if (/(^|\/)[^?#]+\.html(?=[?#]|$)/i.test(href)) {
        a.setAttribute('href', stripHtmlExt(href));
      }
    });

    // Show a friendly notice if user tried a .html URL
    try {
      var tried = localStorage.getItem("triedHtmlUrl");
      if (tried) {
        localStorage.removeItem("triedHtmlUrl");
        var bar = document.createElement("div");
        bar.id = "urlNotice";
        bar.textContent = "Heads up: our URLs no longer use .html â€” youâ€™re in the right place.";
        bar.style.position = "fixed";
        bar.style.left = "50%";
        bar.style.transform = "translateX(-50%)";
        bar.style.top = "12px";
        bar.style.zIndex = "99999";
        bar.style.padding = "10px 14px";
        bar.style.borderRadius = "10px";
        bar.style.boxShadow = "0 4px 14px rgba(0,0,0,0.15)";
        bar.style.background = "#111";
        bar.style.color = "#fff";
        bar.style.fontFamily = "system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif";
        bar.style.fontSize = "14px";

        var closeBtn = document.createElement("button");
        closeBtn.setAttribute("aria-label", "Dismiss");
        closeBtn.textContent = "Ã—";
        closeBtn.style.marginLeft = "10px";
        closeBtn.style.background = "transparent";
        closeBtn.style.border = "none";
        closeBtn.style.color = "inherit";
        closeBtn.style.fontSize = "16px";
        closeBtn.style.cursor = "pointer";
        closeBtn.addEventListener("click", function () {
          bar.remove();
        });
        bar.appendChild(closeBtn);
        document.body.appendChild(bar);
      }
    } catch (e) {}
  });
})();
</script>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-container">
                <a href="./" class="logo-name">Admin Dashboard</a>
            </div>
            <nav>
                <ul>
                    <li><a href="./">Back to Main Site</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="app-container">
        <section id="admin-section">
            <div class="section-container">
                <div id="admin-login-view" class="hidden">
                    <h2>Admin Login</h2>
                    <div class="auth-wrapper" style="margin: 2rem 0;">
                        <form id="admin-login-form">
                            <label for="admin-login-email">Admin Email</label>
                            <input type="email" id="admin-login-email" required>
                            <label for="admin-login-password">Admin Password</label>
                            <input type="password" id="admin-login-password" required>
                            <button type="submit" class="btn">Login</button>
                        </form>
                        <p id="admin-auth-error" class="error-message hidden"></p>
                    </div>
                </div>

                <div id="admin-dashboard-view">
                    <div id="admin-user-info" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2>Admin Dashboard</h2>
                        <button id="admin-logout-btn" class="btn btn-secondary">Logout</button>
                    </div>

                    <div id="dashboard-container">
                        <div id="orders-column">
                            <div id="all-orders-list">
                                <p>Loading all orders...</p>
                            </div>
                        </div>

                        <div id="chats-column">
                            <h3>Client Chats</h3>
                            <div id="all-chats-list">
                                <p>Loading chats...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="unauthorized-view" class="hidden">
                    <h2>Access Denied</h2>
                    <p>The credentials you entered do not belong to an authorized administrator.</p>
                </div>
            </div>
        </section>
    </main>

    <div id="chat-modal" class="chat-modal-backdrop">
        <div class="chat-modal">
            <div class="chat-header">
                <h3 id="chat-header-title">Chat</h3>
                <button id="close-chat-btn">&times;</button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <form id="chat-input-form" class="chat-input-form">
                <textarea id="chat-message-input" placeholder="Type a message..." rows="1"></textarea>
                <input type="file" id="chat-file-input">
                <label for="chat-file-input" id="chat-file-label" title="Attach File">ðŸ“Ž</label>
                <button id="send-chat-btn" type="submit" class="btn">Send</button>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Mistireselassie W. All rights reserved.</p>
    </footer>

    <script type="module" src="/auth.js"></script>
    <script type="module" src="/config.js"></script>
    <script type="module" src="/chat.js"></script>
    <script type="module" src="/admin_dashboard.js"></script>
</body>
</html>

